-- ======================================================
-- ðŸ“Œ FPS THANHLONG - Spam Items + Anti-Accessories (Menu Thu Nhá»)
-- ======================================================

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local playerGui = LocalPlayer:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- ======================================================
-- ðŸ”¹ XÃ“A PHá»¤ KIá»†N Cá»¦A Báº N KHI CHáº¾T/TÃI SINH
-- ======================================================
local function removeAllAccessoriesFromCharacter()
    local character = LocalPlayer.Character
    if not character then return end
    for _, item in ipairs(character:GetChildren()) do
        if item:IsA("Accessory") or item:IsA("LayeredClothing")
           or item:IsA("Shirt") or item:IsA("ShirtGraphic")
           or item:IsA("Pants") or item:IsA("BodyColors")
           or item:IsA("CharacterMesh") then
            pcall(function() item:Destroy() end)
        end
    end
end

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.1)
    -- XÃ³a liÃªn tá»¥c vÃ i láº§n Ä‘á»ƒ cháº¯c cháº¯n táº¥t cáº£ item spawn xong
    for i = 1, 10 do
        removeAllAccessoriesFromCharacter()
        task.wait(0.1)
    end
end)
if LocalPlayer.Character then
    task.defer(function()
        for i = 1, 10 do
            removeAllAccessoriesFromCharacter()
            task.wait(0.1)
        end
    end)
end

-- ======================================================
-- ðŸ”¹ DANH SÃCH ITEM CHO SPAM
-- ======================================================
local allowedItems = {
    ["Tung Bat"] = true,
    ["Medusa's Head"] = true,
    ["Laser Cape"] = true,
    ["Taser Gun"] = true,
    ["Bee Launcher"] = true
}

-- ======================================================
-- ðŸ”¹ Há»† THá»NG SPAM ITEM
-- ======================================================
local InventorySpam = {running = false, delay = 0.1}

function InventorySpam:Start()
    if self.running then return end
    self.running = true
    self._stop = false
    task.spawn(function()
        while self.running and not self._stop do
            local backpack = LocalPlayer:FindFirstChild("Backpack")
            if backpack and LocalPlayer.Character then
                for _, tool in ipairs(backpack:GetChildren()) do
                    if not self.running then break end
                    if tool:IsA("Tool") and allowedItems[tool.Name] then
                        tool.Parent = LocalPlayer.Character
                        task.wait(self.delay/2)
                        tool.Parent = backpack
                        task.wait(self.delay/2)
                    end
                end
            else
                task.wait(0.2)
            end
        end
    end)
end

function InventorySpam:Stop()
    self.running = false
    self._stop = true
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    local char = LocalPlayer.Character
    if backpack and char then
        for _, tool in ipairs(char:GetChildren()) do
            if tool:IsA("Tool") then
                tool.Parent = backpack
            end
        end
    end
end

LocalPlayer.CharacterAdded:Connect(function()
    InventorySpam:Stop()
    task.wait(0.2)
    -- XÃ³a Ä‘á»“ báº£n thÃ¢n khi tÃ¡i sinh
    for i = 1, 10 do
        removeAllAccessoriesFromCharacter()
        task.wait(0.1)
    end
end)

-- ======================================================
-- ðŸ”¹ ANTI-SPAM ACCESSORIES (CHO NGÆ¯á»œI KHÃC)
-- ======================================================
local maxChangePerInterval = 2
local lastCounts = {}

local function countAllAccessories(character)
    if not character then return 0 end
    local count = 0
    for _, obj in ipairs(character:GetChildren()) do
        if obj:IsA("Tool") or obj:IsA("Accessory") or obj:IsA("LayeredClothing") then
            count = count + 1
        end
    end
    return count
end

local function removeAllAccessories(character)
    if not character then return end
    for _, obj in ipairs(character:GetChildren()) do
        if obj:IsA("Tool") or obj:IsA("Accessory") or obj:IsA("LayeredClothing") then
            pcall(function() obj:Destroy() end)
        end
    end
end

local function checkPlayers()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local currentCount = countAllAccessories(player.Character)
            local lastCount = lastCounts[player] or 0

            if currentCount - lastCount > maxChangePerInterval then
                removeAllAccessories(player.Character)
            end

            lastCounts[player] = currentCount
        end
    end
end

Players.PlayerAdded:Connect(function(player)
    lastCounts[player] = 0
    player.CharacterAdded:Connect(function(char)
        task.wait(0.2)
        removeAllAccessories(char)
        lastCounts[player] = countAllAccessories(char)
    end)
end)

Players.PlayerRemoving:Connect(function(player)
    lastCounts[player] = nil
end)

RunService.Heartbeat:Connect(checkPlayers)

-- ======================================================
-- ðŸ”¹ GUI FPS THANHLONG (THU NHá»Ž, DI CHUYá»‚N ÄÆ¯á»¢C)
-- ======================================================
local old = playerGui:FindFirstChild("FPS_THANHLONG_PANEL")
if old then old:Destroy() end

local gui = Instance.new("ScreenGui")
gui.Name = "FPS_THANHLONG_PANEL"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local panel = Instance.new("Frame", gui)
panel.BackgroundColor3 = Color3.fromRGB(15,15,15)
panel.BorderSizePixel = 0
Instance.new("UICorner", panel).CornerRadius = UDim.new(0, 10)

local title = Instance.new("TextLabel", panel)
title.Size = UDim2.new(1,0,0,20)
title.Text = "FPS THANHLONG"
title.Font = Enum.Font.GothamBold
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextSize = 13

local btn = Instance.new("TextButton", panel)
btn.BackgroundColor3 = Color3.fromRGB(28,28,28)
btn.Text = "SPAM"
btn.Font = Enum.Font.GothamBold
btn.TextColor3 = Color3.fromRGB(255,255,255)
btn.BorderSizePixel = 0
Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
btn.Size = UDim2.new(1, -20, 0, 28)
btn.Position = UDim2.new(0, 10, 0, 25)
btn.TextSize = 13

local circle = Instance.new("Frame", btn)
circle.BackgroundColor3 = Color3.fromRGB(255,40,40)
circle.BorderSizePixel = 0
Instance.new("UICorner", circle).CornerRadius = UDim.new(1, 0)
circle.Size = UDim2.new(0, 12, 0, 12)
circle.Position = UDim2.new(0, 5, 0.5, -6)

local state = false
local function updateVisual()
    circle.BackgroundColor3 = state and Color3.fromRGB(50,255,60) or Color3.fromRGB(255,40,40)
end

btn.MouseButton1Click:Connect(function()
    state = not state
    if state then
        InventorySpam:Start()
    else
        InventorySpam:Stop()
    end
    updateVisual()
end)
updateVisual()

local velocityBox = Instance.new("TextBox", panel)
velocityBox.PlaceholderText = tostring(InventorySpam.delay)
velocityBox.Text = tostring(InventorySpam.delay)
velocityBox.Font = Enum.Font.Gotham
velocityBox.BackgroundColor3 = Color3.fromRGB(28,28,28)
velocityBox.TextColor3 = Color3.fromRGB(255,255,255)
velocityBox.BorderSizePixel = 0
Instance.new("UICorner", velocityBox).CornerRadius = UDim.new(0, 6)
velocityBox.Size = UDim2.new(1, -20, 0, 22)
velocityBox.Position = UDim2.new(0, 10, 0, 60)
velocityBox.TextSize = 12

velocityBox.FocusLost:Connect(function()
    local val = tonumber(velocityBox.Text)
    if val and val > 0 then
        InventorySpam.delay = val
    else
        velocityBox.Text = tostring(InventorySpam.delay)
    end
end)

-- ======================================================
-- ðŸ”¹ AUTO-ADAPT PC/MOBILE + CENTER
-- ======================================================
local function acomodarUI()
    local screenSize = workspace.CurrentCamera.ViewportSize
    local isMobile = screenSize.X < 1000

    if isMobile then
        panel.Size = UDim2.new(0, 160, 0, 90)
        title.TextSize = 12
        btn.Size = UDim2.new(1, -20, 0, 28)
        btn.Position = UDim2.new(0, 10, 0, 25)
        btn.TextSize = 12
        circle.Size = UDim2.new(0, 10, 0, 10)
        circle.Position = UDim2.new(0, 5, 0.5, -5)
        velocityBox.Size = UDim2.new(1, -20, 0, 20)
        velocityBox.Position = UDim2.new(0, 10, 0, 55)
        velocityBox.TextSize = 11
    else
        panel.Size = UDim2.new(0, 180, 0, 95)
        title.TextSize = 14
        btn.Size = UDim2.new(1, -20, 0, 28)
        btn.Position = UDim2.new(0, 10, 0, 25)
        btn.TextSize = 13
        circle.Size = UDim2.new(0, 12, 0, 12)
        circle.Position = UDim2.new(0, 5, 0.5, -6)
        velocityBox.Size = UDim2.new(1, -20, 0, 22)
        velocityBox.Position = UDim2.new(0, 10, 0, 60)
        velocityBox.TextSize = 12
    end

    panel.Position = UDim2.new(0.5, 0, 0.5, 0)
    panel.AnchorPoint = Vector2.new(0.5, 0.5)
end

acomodarUI()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(acomodarUI)

-- ======================================================
-- ðŸ”¹ DRAG UNIVERSAL
-- ======================================================
local dragging = false
local dragStart, startPos

panel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or
       input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = panel.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

panel.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or
       input.UserInputType == Enum.UserInputType.Touch then
        if dragging then
            local delta = input.Position - dragStart
            panel.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end
end)
